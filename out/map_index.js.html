<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: map/index.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: map/index.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>//подключаем стили
import '../libraries/fontawesome/css/font-awesome.css';
import '../libraries/gzm/gzm.css';
import '../libraries/gzm/leaflet.css';
//подключаем leaflet
const leafletLib = require('imports-loader?jQuery=jquery!exports-loader?L!../libraries/gzm/leaflet-src.js');
window.L = leafletLib;
//подключаем gzm
const gzmLib = require('imports-loader?jQuery=jquery!../libraries/gzm/gzm.js');
import * as componentLib from '../component';
import * as tools from '../tools/index.js';
/**
 * Заготовка для отображения карт
 */
export class Map extends componentLib.Component {
    constructor(param) {
        super(param);
        this.gzmCore = '';
        this.map = '';
        this.editor = '';
        this.staticObjects = {};
        this.saveInWindow();
        this.render();
        this.deployObjects();
        this.addListeners()
    }

    addListeners() {
        if (this.events.mapSelected !== undefined) {
            this.gzmCore.addListener('mapSelect', function (event) {
                /*
                 TODO
                 getUUIDbyObjectID(objectID)
                 */
                let uuid = '';
                for (let i in this.staticObjects.geoZones) {
                    if (this.staticObjects.geoZones[i].objectID === event.objectInfo.objectID) {
                        uuid = this.staticObjects.geoZones[i].uuid;
                        break;
                    }
                }
                this.code[this.events.mapSelected].call(this, uuid);
            }.bind(this))
        }
    }

    deployObjects() {
        this.makeObjectsForMap();
        this.gzmCore.deployObjects(this.staticObjects);
        this.gzmCore.fitMap();

    }

    /**
     * Соединяем все с ядром
     */
    connectToCore() {
        this.gzmCore.plugMap(this.map);
        this.gzmCore.plugEditor(this.editor);
    }

    /**
     * Создаем ядро редактора
     */
    createGzmCore() {
        this.gzmCore = new GeoZoneManager();
    }

    /**
     * Создаем редактор
     */
    createEditor() {
        this.editor = new Editor(this.gzmCore);
    }

    /**
     * Создаем объект для размещения на карте
     */
    makeObjectsForMap() {
        let result = {};
        result.geoZones = [];
        let prepRecs = this.prepareData(this.content);
        let records = prepRecs.records;
        let fk = prepRecs.fk;
        for (let i in records) {
            let coords = [];
            let coordsStr = records[i].coords;
            coordsStr = coordsStr.slice(2);
            coordsStr = coordsStr.substr(0, coordsStr.length - 3);
            coordsStr = coordsStr.split('),(');
            for (let j in coordsStr) {
                coords.push([parseFloat(coordsStr[j].split(',')[0]), parseFloat(coordsStr[j].split(',')[1])]);
            }
            result.geoZones.push({
                uuid: records[i].ID,
                props: {test: {value: 'testValue'}},
                nodes: coords
            })
        }
        this.staticObjects = result;
    }

    /**
     * Выделяет объект на карте
     * @param uuid
     */
    setSelection(uuid) {
        /*
         TODO
         getObjectIDbyUUID(uuid)
         */
        for (let i in this.staticObjects.geoZones) {
            if (this.staticObjects.geoZones[i].uuid === uuid) {
                this.gzmCore.map.focus(this.staticObjects.geoZones[i].objectID);
                break;
            }
        }
    }

    /**
     * Размещает карту на странице в боксе
     */
    render() {
        let placeMap = document.createElement('div');
        placeMap.style.height = '100%';
        this.box.appendChild(placeMap);
        //создаем место для карты
        this.map = new LeafletStaticMap(placeMap);
        this.createGzmCore();
        this.createEditor();
        this.connectToCore();
    }
}</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-component.html">component</a></li><li><a href="module-grid.html">grid</a></li><li><a href="module-tools.html">tools</a></li></ul><h3>Classes</h3><ul><li><a href="Map.html">Map</a></li><li><a href="module.exports.html">exports</a></li><li><a href="module-component.Component.html">Component</a></li><li><a href="module-grid.Grid.html">Grid</a></li><li><a href="Page.html">Page</a></li><li><a href="Popup.html">Popup</a></li></ul><h3>Global</h3><ul><li><a href="global.html#auth">auth</a></li><li><a href="global.html#buildNavigatorToolbar">buildNavigatorToolbar</a></li><li><a href="global.html#config">config</a></li><li><a href="global.html#on">on</a></li><li><a href="global.html#refresh">refresh</a></li><li><a href="global.html#render">render</a></li><li><a href="global.html#showPage">showPage</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.3</a> on Wed Aug 02 2017 13:02:59 GMT+0800 (RTZ 7 (зима))
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
